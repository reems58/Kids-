# ูุธุงู ุฅุฏุงุฑุฉ ุงูููุงู ุงูุชุนููููุฉ

## ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงูููุงู ุงูุชุนููููุฉ ููุฃุทูุงู ูุชุถูู:
- ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู
- ุฌูุจ ููุงู ุทูู ูุนูู ูุน ุชูุงุตูู ุงููุญุชูู
- ุฌูุจ ูู ุงููุญุชูู ุฃู ุงููุญุชูู ุญุณุจ ุงูุนูุฑ
- ุฅุถุงูุฉ ูููุฉ ุฌุฏูุฏุฉ ูุน ุชุญุฏูุฏ ุงูุชุฑุชูุจ
- ุญุฐู ูููุฉ ูุน ุฅุนุงุฏุฉ ุชุฑุชูุจ ุชููุงุฆู
- ุชุบููุฑ ุชุฑุชูุจ ุงูููุงู (ููุฃุนูู ุฃู ููุฃุณูู)

## ุงููููุงุช

### ูููุงุช API (Backend)

#### 1. `api/tasks/check_auth.php`
ููู ูุณุงุนุฏ ููุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูููููุฉ ุงูุทูู/ุงููููุฉ.

**ุงูุฏูุงู ุงููุชุงุญุฉ:**
- `checkAuth()`: ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ูุฅุฑุฌุงุน `parent_id`
- `checkChildOwnership($pdo, $parent_id, $child_id)`: ุงูุชุญูู ูู ููููุฉ ุงูุทูู
- `checkTaskOwnership($pdo, $parent_id, $task_id)`: ุงูุชุญูู ูู ููููุฉ ุงููููุฉ

#### 2. `api/tasks/get_child_tasks.php`
ุฌูุจ ููุงู ุทูู ูุนูู ูุน ุชูุงุตูู ุงููุญุชูู.

**ุงููุนุงููุงุช:**
- `child_id` (GET): ูุนุฑู ุงูุทูู

**ูุซุงู ุงูุงุณุชุฎุฏุงู:**
```
GET /api/tasks/get_child_tasks.php?child_id=1
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
    "success": true,
    "tasks": [
        {
            "task_id": 1,
            "task_name_ar": "ุชุนูู ุงูุฃุฑูุงู",
            "description": "...",
            "duration_minutes": 10,
            "order_index": 1,
            "status": "pending",
            "content_id": 1,
            "content_name_ar": "ุงูุฑูุงุถูุงุช",
            "icon": "๐",
            "last_session": {...}
        }
    ],
    "count": 1
}
```

#### 3. `api/tasks/get_all_content.php`
ุฌูุจ ูู ุงููุญุชูู ุงูุชุนูููู.

**ูุซุงู ุงูุงุณุชุฎุฏุงู:**
```
GET /api/tasks/get_all_content.php
```

**ุงูุงุณุชุฌุงุจุฉ:**
```json
{
    "success": true,
    "content": [
        {
            "content_id": 1,
            "content_name_ar": "ุงูุฑูุงุถูุงุช",
            "min_age": 3,
            "max_age": 12,
            "difficulty": "ุณูู",
            "icon": "๐"
        }
    ],
    "count": 1
}
```

#### 4. `api/tasks/get_content_by_age.php`
ุฌูุจ ุงููุญุชูู ุงูุชุนูููู ุญุณุจ ุงูุนูุฑ.

**ุงููุนุงููุงุช:**
- `age` (GET): ุนูุฑ ุงูุทูู

**ูุซุงู ุงูุงุณุชุฎุฏุงู:**
```
GET /api/tasks/get_content_by_age.php?age=5
```

#### 5. `api/tasks/add_task.php`
ุฅุถุงูุฉ ูููุฉ ุฌุฏูุฏุฉ ูุน ุชุญุฏูุฏ ุงูุชุฑุชูุจ.

**ุงููุนุงููุงุช (POST JSON):**
```json
{
    "child_id": 1,
    "content_id": 1,
    "task_name": "Learn Numbers",
    "task_name_ar": "ุชุนูู ุงูุฃุฑูุงู",
    "description": "ุชุนูู ุงูุฃุฑูุงู ูู 1 ุฅูู 10",
    "duration_minutes": 10,
    "order_index": 1,  // ุงุฎุชูุงุฑู: null ูุนูู ุฅุถุงูุฉ ูู ุงูููุงูุฉ
    "parent_note": "ููุงุญุธุฉ ูู ุงูุฃูู"  // ุงุฎุชูุงุฑู
}
```

**ูุซุงู ุงูุงุณุชุฎุฏุงู:**
```javascript
const response = await fetch('../api/tasks/add_task.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        child_id: 1,
        content_id: 1,
        task_name_ar: "ุชุนูู ุงูุฃุฑูุงู",
        duration_minutes: 10
    })
});
```

#### 6. `api/tasks/delete_task.php`
ุญุฐู ูููุฉ ูุน ุฅุนุงุฏุฉ ุชุฑุชูุจ ุงูููุงู ุชููุงุฆูุงู.

**ุงููุนุงููุงุช (POST JSON):**
```json
{
    "task_id": 1
}
```

**ูุซุงู ุงูุงุณุชุฎุฏุงู:**
```javascript
const response = await fetch('../api/tasks/delete_task.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ task_id: 1 })
});
```

#### 7. `api/tasks/reorder_task.php`
ุชุบููุฑ ุชุฑุชูุจ ุงููููุฉ (ููุฃุนูู ุฃู ููุฃุณูู).

**ุงููุนุงููุงุช (POST JSON):**
```json
{
    "task_id": 1,
    "direction": "up"  // ุฃู "down"
}
```

**ูุซุงู ุงูุงุณุชุฎุฏุงู:**
```javascript
const response = await fetch('../api/tasks/reorder_task.php', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        task_id: 1,
        direction: "up"
    })
});
```

### ููู JavaScript (Frontend)

#### `js/task_manager.js`
ููุชุจุฉ JavaScript ูุฅุฏุงุฑุฉ ุงูููุงู ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ.

**ุงูุฏูุงู ุงููุชุงุญุฉ:**

```javascript
// ุฌูุจ ููุงู ุทูู
const tasks = await TaskManager.getChildTasks(childId);

// ุฌูุจ ูู ุงููุญุชูู
const content = await TaskManager.getAllContent();

// ุฌูุจ ุงููุญุชูู ุญุณุจ ุงูุนูุฑ
const content = await TaskManager.getContentByAge(5);

// ุฅุถุงูุฉ ูููุฉ
const task = await TaskManager.addTask({
    child_id: 1,
    content_id: 1,
    task_name_ar: "ุชุนูู ุงูุฃุฑูุงู",
    duration_minutes: 10
});

// ุญุฐู ูููุฉ
await TaskManager.deleteTask(taskId);

// ููู ูููุฉ ููุฃุนูู
await TaskManager.moveTaskUp(taskId);

// ููู ูููุฉ ููุฃุณูู
await TaskManager.moveTaskDown(taskId);
```

## ุงูููุฒุงุช ุงูุฃูููุฉ

### 1. ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู
ุฌููุน API endpoints ุชุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู ุนุจุฑ `check_auth.php`.

### 2. ุงูุชุญูู ูู ุงูููููุฉ
- ุงูุชุญูู ูู ุฃู ุงูุทูู ูุฎุต ุงููุงูุฏ ุงููุณุฌู
- ุงูุชุญูู ูู ุฃู ุงููููุฉ ุชุฎุต ุงููุงูุฏ ุงููุณุฌู

### 3. ุงุณุชุฎุฏุงู Transactions
ุฌููุน ุงูุนูููุงุช ุงูุญุณุงุณุฉ (ุฅุถุงูุฉุ ุญุฐูุ ุฅุนุงุฏุฉ ุชุฑุชูุจ) ุชุณุชุฎุฏู Transactions ูุถูุงู:
- ุนุฏู ููุฏุงู ุงูุจูุงูุงุช
- ุงูุชูุงูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฅููุงููุฉ ุงูุชุฑุงุฌุน ูู ุญุงูุฉ ุงูุฎุทุฃ

### 4. ูุนุงููุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช (Prepared Statements)
ุฌููุน ุงูุงุณุชุนูุงูุงุช ุชุณุชุฎุฏู Prepared Statements ูููุน SQL Injection.

## ุฅุฏุงุฑุฉ ุงูุชุฑุชูุจ (order_index)

### ุขููุฉ ุงูุนูู:
1. **ุนูุฏ ุงูุฅุถุงูุฉ:**
   - ุฅุฐุง ุชู ุชุญุฏูุฏ `order_index`: ูุชู ุฅุฒุงุญุฉ ุงูููุงู ุงูููุฌูุฏุฉ
   - ุฅุฐุง ูุงู `null`: ูุชู ุฅุถุงูุฉ ุงููููุฉ ูู ุงูููุงูุฉ (ุฃุนูู order_index + 1)

2. **ุนูุฏ ุงูุญุฐู:**
   - ูุชู ุชูููู `order_index` ูุฌููุน ุงูููุงู ุงูุชู ุจุนุฏ ุงููููุฉ ุงููุญุฐููุฉ

3. **ุนูุฏ ุฅุนุงุฏุฉ ุงูุชุฑุชูุจ:**
   - `up`: ูุชู ุงูุชุจุฏูู ูุน ุงููููุฉ ุงูุชู ูุจููุง
   - `down`: ูุชู ุงูุชุจุฏูู ูุน ุงููููุฉ ุงูุชู ุจุนุฏูุง

## ูุซุงู ุงุณุชุฎุฏุงู ูุงูู

```javascript
// 1. ุฌูุจ ููุงู ุทูู
const tasks = await TaskManager.getChildTasks(1);
console.log('ุงูููุงู:', tasks);

// 2. ุฌูุจ ุงููุญุชูู ุงููุชุงุญ
const content = await TaskManager.getContentByAge(5);
console.log('ุงููุญุชูู ุงูููุงุณุจ ููุนูุฑ 5:', content);

// 3. ุฅุถุงูุฉ ูููุฉ ุฌุฏูุฏุฉ
const newTask = await TaskManager.addTask({
    child_id: 1,
    content_id: content[0].content_id,
    task_name_ar: "ุชุนูู ุงูุฃุฑูุงู",
    duration_minutes: 15,
    order_index: 1  // ุฅุถุงูุฉ ูู ุงูุจุฏุงูุฉ
});
console.log('ุชูุช ุฅุถุงูุฉ ุงููููุฉ:', newTask);

// 4. ููู ุงููููุฉ ููุฃุนูู
await TaskManager.moveTaskUp(newTask.task_id);

// 5. ุญุฐู ุงููููุฉ
await TaskManager.deleteTask(newTask.task_id);
```

## ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก

ุฌููุน ุงูุฏูุงู ุชุฑูู ุงุณุชุซูุงุกุงุช ูู ุญุงูุฉ ุงููุดู. ูุฌุจ ุงุณุชุฎุฏุงู `try-catch`:

```javascript
try {
    const tasks = await TaskManager.getChildTasks(1);
} catch (error) {
    TaskManager.showError(error.message);
}
```

## ููุงุญุธุงุช ูููุฉ

1. **ุงูุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู:** ูุฌุจ ุฃู ูููู ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู ูุจู ุงุณุชุฎุฏุงู ุฃู API
2. **ุงูููููุฉ:** ูููู ูููุงูุฏ ููุท ุฅุฏุงุฑุฉ ููุงู ุฃุทูุงูู
3. **ุงูุชุฑุชูุจ:** `order_index` ูุจุฏุฃ ูู 0 ุฃู 1 ุญุณุจ ุงูุชุตููู
4. **ุงููุนุงููุงุช:** ุฌููุน ุงููุนุงููุงุช ูุชู ุงูุชุญูู ูููุง ูุจู ุงููุนุงูุฌุฉ
5. **ุงูุชุฑุงุฌุน:** ูู ุญุงูุฉ ุงูุฎุทุฃุ ูุชู ุงูุชุฑุงุฌุน ุนู ุฌููุน ุงูุชุบููุฑุงุช (Rollback)

## ุงูุงุฎุชุจุงุฑ

ูููู ุงุฎุชุจุงุฑ ุงููุธุงู ุจุงุณุชุฎุฏุงู:
- Postman
- curl
- JavaScript fetch API
- ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงููุฎุตุตุฉ

## ุงูุฏุนู

ูู ุญุงูุฉ ูุฌูุฏ ูุดุงูู:
1. ุชุญูู ูู ุชุณุฌูู ุงูุฏุฎูู
2. ุชุญูู ูู ููููุฉ ุงูุทูู/ุงููููุฉ
3. ุฑุงุฌุน ุณุฌูุงุช ุงูุฃุฎุทุงุก (error_log)
4. ุชุฃูุฏ ูู ูุฌูุฏ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

